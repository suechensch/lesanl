clear
close all
%path='M:\MyDocuments\Matlab\6.1 cloud\campex dropsonds\2019-09-27-SF15\2019-09-27-SF15\subset\';
path='../data/';
opath=['../figures/'],
fldid={'pres','tdry','dp','u_wind','v_wind'};
fname=dir([path,'CAMP2EX_AVAPS_RD41_*.nc']); 
tnf=length(fname);
figure;
colormap(jet)
ifwrite=0;
ifplot=1;
mycolors=[0 0 1
         1 0 0
         0 1 0
         1 0 1
         1 0.5 0.5
         0.8 0.6 0
         0 1 0
         0 1 1];
psnd = [1008.9, 1006.2, 1003.4, 1000.7,  998.0,  995.3,  992.6,  989.9,  987.2,  ...
    984.5,  981.9,  979.3,  976.7,  974.0,  971.3,  968.6,  965.9,  963.2,  ...
    960.6,  958.0,  955.4,  952.6,  949.9,  947.3,  944.5,  941.8,  939.1, ...
    936.3,  933.6,  930.8,  928.1,  925.4,  922.7,  920.1,  917.4,  914.8, ...
    912.2,  909.5,  906.9,  904.3,  901.7,  899.1,  896.5,  893.9,  891.3, ...
    888.7,  885.6,  883.1,  880.5,  877.9,  875.2,  872.7,  869.6,  866.5, ...
    863.9,  861.3,  857.7,  855.1,  852.1,  848.9,  845.8,  843.3,  840.8, ...
    837.7,  835.1,  832.6,  829.5,  826.9,  824.4,  821.9,  817.8,  814.8, ...
    811.2,  808.7,  806.2,  803.6,  800.6,  798.1,  794.5,  792.0,  789.5, ...
    786.9,  783.9,  781.3,  778.7,  775.6,  773.1,  770.6,  768.0,  765.5, ...
    762.4,  759.9,  757.3,  754.8,  752.3,  749.8,  747.3,  744.7,  742.2, ...
    739.2,  735.7,  732.2,  728.8,  725.8,  723.2,  720.2,  716.7,  714.1, ...
    711.6,  708.7,  706.2,  703.1,  700.6,  697.6,  694.6,  692.1,  688.7, ...
    686.2,  683.3,  679.3,  676.9,  674.5,  672.0,  668.6,  666.2,  663.8, ...
    661.4,  659.0,  656.6,  654.2,  651.8,  648.9,  646.4,  643.6,  640.2, ...
    637.3,  634.4,  632.0,  629.6,  626.7,  623.4,  621.0,  618.6,  615.7, ...
    613.3,  610.9,  608.6,  606.3,  603.9,  601.5,  598.6,  596.2,  593.9, ...
    591.5,  589.2,  586.8,  584.5,  582.1,  579.8,  577.4,  575.1,  572.7, ...
    570.4,  568.1,  565.7,  563.4,  561.1,  558.8,  556.5,  553.7,  551.4, ...
    549.1,  546.8,  544.5,  542.2,  539.9,  537.7,  535.4,  533.1,  530.9, ...
    528.6,  526.4,  524.1,  521.9,  519.7,  517.5,  515.3,  513.0,  510.8, ...
    508.6,  506.3,  504.1,  501.9];%  400.0,  300.0,  200.0,
usnd =  [-2.9,   -2.9,   -2.9,   -3.1,   -3.2,   -3.1,   -3.1,   -3.2, ...
    -3.1,   -3.1,   -3.2,   -3.3,   -3.2,   -3.2,   -3.2,   -3.4,   -3.6, ...
    -3.8,   -4.2,   -4.4,   -4.5,   -4.7,   -4.8,   -5.0,   -4.9,   -4.8, ...
    -4.8,   -4.9,   -4.9,   -4.5,   -4.1,   -4.0,   -4.0,   -3.8,   -3.7, ...
    -3.8,   -3.8,   -3.7,   -3.5,   -3.4,   -3.3,   -3.3,   -3.6,   -4.0, ...
    -4.3,   -4.2,   -4.0,   -3.9,   -3.6,   -3.4,   -3.2,   -3.2,   -3.7, ...
    -4.0,   -4.2,   -4.1,   -4.0,   -4.0,   -4.1,   -4.5,   -4.4,   -4.2, ... 
    -4.2,   -3.8,   -3.4,   -3.2,   -3.2,   -2.9,   -2.8,   -2.9,   -3.0, ...
    -3.0,   -3.1,   -3.1,   -3.2,   -3.2,   -3.1,   -2.8,   -2.7,   -2.9, ...
    -3.1,   -3.3,   -3.3,   -3.2,   -2.9,   -2.6,   -2.5,   -2.6,   -2.7, ...
    -2.7,   -2.4,   -2.3,   -2.2,   -2.2,   -2.1,   -2.0,   -2.0,   -1.9, ...
    -1.9,   -2.1,   -2.1,   -2.2,   -2.2,   -2.1,   -2.0,   -1.9,   -1.8, ...
    -1.8,   -1.8,   -1.9,   -2.0,   -2.0,   -1.9,   -1.9,   -2.0,   -2.1, ...
    -2.1,   -2.2,   -2.2,   -2.1,   -2.2,   -2.2,   -2.4,   -2.4,   -2.2, ...
    -2.1,   -2.1,   -2.1,   -2.0,   -2.0,   -2.0,   -2.1,   -2.1,   -2.1, ...
    -2.2,   -2.6,   -2.8,   -2.7,   -2.5,   -2.3,   -2.1,   -2.2,   -2.2, ...
    -2.3,   -2.4,   -2.5,   -2.5,   -2.4,   -2.2,   -2.1,   -2.2,   -2.0, ...
    -2.0,   -2.2,   -2.1,   -1.9,   -1.7,   -1.7,   -1.8,   -1.8,   -1.6, ...
    -1.4,   -1.3,   -1.2,   -1.1,   -0.9,   -0.5,   -0.5,   -0.6,   -0.9, ...
    -0.9,   -0.9,   -0.8,   -0.7,   -0.6,   -0.7,   -0.8,   -0.6,   -0.4, ...
    -0.3,   -0.5,   -0.7,   -0.9,   -1.1,   -1.3,   -1.2,   -0.8,   -0.3, ...
    -0.0,   -0.2,   -0.4,   -0.3,   -0.4,   -0.4,   -0.4,   -0.4 ];
vsnd =   [-3.1,   -3.0,   -3.2,   -3.2,   -3.2,   -3.3,   -3.3,   -3.3, ...
    -3.4,   -3.3,   -3.3,   -3.4,   -3.4,   -3.6,   -3.8,   -3.9,   ...
    -4.0,   -3.9,   -3.8,   -3.8,   -3.8,   -3.9,   -3.9,   -3.9,   ...
    -4.0,   -4.0,   -4.0,   -4.0,   -3.9,   -3.6,   -3.4,   -3.4,   ...
    -3.4,   -3.3,   -3.3,   -3.4,   -3.7,   -3.9,   -3.8,   -3.6,   ...
    -3.6,   -3.7,   -4.0,   -3.9,   -3.6,   -3.1,   -2.9,   -2.8,   ...
    -3.0,   -3.1,   -3.0,   -2.8,   -2.6,   -2.6,   -2.5,   -2.6,   ...
    -2.9,   -3.0,   -2.9,   -2.7,   -2.7,   -2.6,   -2.5,   -2.6,   ...
    -2.5,   -2.6,   -3.0,   -3.3,   -3.4,   -3.6,   -3.9,   -3.8,   ...
    -3.5,   -3.5,   -3.6,   -3.6,   -3.7,   -3.6,   -3.3,   -3.0,   ...
    -2.7,   -2.4,   -2.3,   -2.5,   -2.7,   -2.7,   -2.8,   -2.8,   ...
    -2.7,   -2.7,   -2.7,   -2.8,   -2.8,   -2.8,   -2.7,   -2.5,   ...
    -2.3,   -2.2,   -2.1,   -2.0,   -1.9,   -1.9,   -1.9,   -2.0,   ...
    -2.1,   -2.1,   -1.9,   -1.8,   -1.7,   -1.5,   -1.3,   -1.2,   ...
    -1.1,   -1.0,   -0.9,   -1.0,   -0.8,   -0.7,   -0.6,   -0.6,   ...
    -0.6,   -0.5,   -0.3,   -0.3,   -0.4,   -0.3,   -0.0,    0.2,   ...
    0.1,    0.0,    0.1,    0.3,    0.3,    0.2,    0.2,   -0.1,   ...
    -0.3,   -0.1,   -0.0,    0.0,    0.1,    0.1,    0.1,    0.1,  ...
    0.1,    0.0,    0.1,    0.3,    0.6,    0.8,    1.0,    1.2,   ...
    1.3,    1.3,    1.3,    1.3,    1.1,    1.0,    1.0,    0.9,   ...
    0.9,    1.0,    1.3,    1.3,    1.2,    1.0,    0.9,    0.6,   ...
    0.2,   -0.2,   -0.3,   -0.3,   -0.3,   -0.5,   -0.8,   -1.0,   ...
    -0.8,   -0.7,   -0.7,   -0.7,   -0.5,   -0.2,    0.0,    0.3,   ...
    0.3,    0.4,    0.3,    0.1,   -0.1,   -0.2,   -0.2,   -0.1,    ...
    0.1,    0.1,    0.1,    0.1 ];
 psnd1 = [1009.8, 1006.3, 1003.2, 1000.2,  997.2,  994.2,  991.3,  ...
     988.2,  985.2,  982.2,  978.6,  975.6,  972.6,  969.6,  ...
     966.6,  963.9,  959.6,  956.5,  953.5,  950.5,  947.5,  ...
     944.5,  941.5,  937.9,  935.0,  932.0,  929.2,  926.5,  ...
     923.7,  920.8,  918.0,  915.1,  912.2,  909.3,  906.3,  ...
     903.3,  900.4,  897.4,  894.5,  891.5,  888.5,  885.6,  ...
     882.7,  879.9,  876.5,  873.7,  870.9,  868.1,  865.2,  ...
     862.4,  859.6,  856.8,  853.9,  851.0,  848.1,  845.4,  ...
     842.6,  839.7,  836.9,  834.0,  831.1,  828.3,  825.5,  ...
     822.7,  819.9,  817.1,  814.3,  811.6,  808.7,  805.9,  ...
     803.1,  800.3,  797.5,  794.7,  791.9,  789.1,  786.3,  ...
     783.5,  780.8,  778.0,  775.2,  772.4,  769.1,  766.4,  ...
     763.7,  761.0,  758.3,  755.6,  752.8,  750.1,  747.4,  ...
     744.6,  741.9,  739.2,  736.5,  733.9,  731.2,  728.5, ...
     725.3,  722.2,  719.6,  716.5,  713.4,  710.7,  708.1,  ...
     705.5,  702.9,  700.4,  697.8,  694.2,  691.7,  689.2,  ...
     686.1,  683.6,  680.6,  677.6,  675.1,  672.7,  669.7,  ...
     667.1,  664.6,  662.1,  659.6,  657.2,  654.2,  651.7,  ...
     649.2,  646.7,  644.2,  641.7,  639.2,  636.7,  634.2,  ...
     631.2,  628.2,  625.8,  623.3,  619.9,  617.5,  615.1,  ...
     612.7,  610.3,  608.0,  605.6,  603.2,  600.8,  598.4,  ...
     596.0,  593.5,  591.1,  588.8,  586.4,  584.0,  581.6,  ...
     579.2,  576.8,  574.3,  571.9,  569.5,  567.1,  564.7,  ...
     562.4,  560.0,  557.6,  555.3,  553.0,  550.6,  548.3,  ...
     545.9,  543.5,  541.2,  538.9,  536.6,  534.3,  532.0,  ...
     529.7,  527.4,  525.1,  522.8,  520.5,  518.2,  515.9, ...
     513.6,  511.3,  509.1,  506.8,  504.5,  502.2,  500.0,  ...
     497.7,  495.4]; %400.0,  300.0,  200.0 ];

wnd_spd=sqrt(usnd.^2+vsnd.^2);  
%for nf=1:tnf
set(gca,'fontsize',15)
pos1 = [0.2 0.15 0.4 0.7];
%ax1=axes('Position',pos1);
subplot('Position',pos1);
hold all

for nf=1:2
ncid=netcdf.open([path fname(nf).name]);
pres=ncread([path fname(nf).name],fldid{1});
tdry=ncread([path fname(nf).name],fldid{2});
dp=ncread([path fname(nf).name],fldid{3});
u=ncread([path fname(nf).name],fldid{4});
v=ncread([path fname(nf).name],fldid{5});
netcdf.close(ncid);

index=find(isnan(pres)==0);

if ifplot==1
plot(tdry(index),floor(pres(index)),'color',mycolors(nf,:))
plot(dp(index),floor(pres(index)),'color',mycolors(nf,:),'linestyle','--')
set(gca,'YDir','reverse')
legend('T (L1)','Td (L1)','T (L2)','Td (L2)','location','northeast')

end % ifplot



end % nf
xlim([-30 30])
%oname=[opath fname(nf).name(23:37) '_t_td.png'];
oname=[opath 'fig1_t_td.png'];
box on
ylabel('Pressure (mb)')
xlabel('Temperature (^oC)')
title('(a)')
  ax = gca;
  ax.TitleHorizontalAlignment = 'left';

%hold on
pos2 = [0.7 0.15 0.1 0.7];
subplot('Position',pos2)
set(gca,'fontsize',15)
plot(wnd_spd(1:191),psnd1,'k','linewidth',2)
set(gca,'YDir','reverse')
xlabel('Wind speed (ms^-^1)')
title('(b)')
  ax = gca;
  ax.TitleHorizontalAlignment = 'left';
print('-dpng',oname);


